---
title: "APEX4. Добавляем кнопку удалить в каждую строку Interactive report"
layout: "post"
tags: [Oracle, APEX, Interactive Report]
---

Хотя на дворе конец 2019 года,но Apex 4 еще жив. Сегодня досталась задачка. в которой надо добавить кнопку "УДАЛИТЬ" в каждую строку interactive report(IR).

Задача немного осложнялась тем. что надо было добавить только в тех строках, автором которых является текущий пользователь. Много чего перепробовал. но в итоге пришел к решению сделать ссылку с запросом подтверждения и созданием реквеста, который запускает processing. Ссылка генерится селектом как отдельный столбец.

По сути задача решается так:
- создаем  на странице скрытый (hidden) item
- добавляем в запрос столбец с текстом запроса подтверждения  и генерацией реквеста (request) в котором будет жить кнопка
- создаем процесс который будет исполняться по появлению реквеста, т.е. при нажатии на кнопку. 

#### Создаем hidden item

- Правой кнопкой по региону с IR и выбираем пункт Create Page item 
- выбираем тип Hidden -> Next
- придумываем Item Name и по умолчанию проверям, что region это наш IR -> Next  (допустим создали c именем P1_VAL_HID)
- Value Protected ставим No -> Next

#### Создаем столбец в запросе IR

Основываясь на [документации](https://docs.oracle.com/database/121/AEAPI/javascript_api.htm#AEAPI29440), запрос подтверждения и создание реквеста с установкой значения для созданного выше скрытого item'a в моем случае должен выглядеть так:

{% highlight js %}
apex.confirm("Save Department?", {
  request:"SAVE",
  set:{"P1_DEPTNO":ID_COLUMN}
  })
{% endhighlight %}

- "Save Department?" это текст подтверждения который увидим при нажатии на ссылку
- request:"SAVE" это имя создаваемого реквеста.
- set:{"P1_DEPTNO":ID_COLUMN} присваиваем значение item'y P1_DEPTNO значение ID_COLUMN

В коде выше в ID_COLUMN надо будет подставить ID (идентификатор) строки таблицы по которому будем удалять данные. Т.е. в селекте должен быть столбец с этим идентификатором.
Но скрипт выше нельзя просто так вставить в селект. Поэтому надо сгенерить текст ссылки с html тегами и с более подходящим сообщением. Вот например:

```sql
select a.id,
'<a href="javascript:apex.confirm(''Вы действительно хотите удалить запись?'',{request:''DEL'', set:{''P1_DEPTNO'':'||a.id||'}})';">удалить</a> as del_link
from some_table a
```
Для корректного отображения html тегов надо в свойствах поля DEL_LINK y IR поставить Standard Report Column в свойстве Display Type.

#### Создаем process

В разделе Page Processing создаем процесс в ветке Processing->Processes.

- Правой кнопкой на Processes->Create
- Выбираем тип PL\SQL -> Next
- Вводим имя и в Point выбираем On Submit - After Coumputations and Validations -> Next
- Вводим pl\sql код для удаления где можно использовать значение :P1_DEPTNO -> Next
- Если надо вводим тексты сообщений -> Next
- значение When Button Pressed выставляем в No Button Condition, а в condition Type выбираем Request= Expression 1 и в поле Expression 1 вводим имя созданного ранее реквеста  DEL

 Теперь при появлении реквеста DEL (при нажатии на ссылку ) будет срабатывать pl\sql код и выполняться те действия, что там прописаны с возможностью использования в коде  ID строки из селекта IR
 